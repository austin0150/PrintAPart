<!DOCTYPE html>
<html lang="en">
<link rel="shortcut icon" type="image/jpg" href="images/faviconImageClear.png">
<head>
    <%- include('../partials/head'); %>
</head>

<header>
    <%- include('../partials/header'); %>
</header>
<main>

    <div class="container">
        <h1>Welcome to Community Management</h1>
        <br>
          <button class="btn btn-success mb-2" onclick="createCommunity()">Add Community</button>
          <br>

          <table class="table">
            <thead>
              <tr>
                <th scope="col"><input type="checkbox" onClick="toggle(this); " /></th>
                <th scope="col">CID</th>
                <th scope="col">Comm Name</th>
                <th scope="col">Description</th>
                <th scope="col">
                    <div class="btn btn-outline-danger" id="deleteCommunityButton" onclick="confirmMessage()">Delete Community</div>
                </th>
                </tr>
            </thead>
            <tbody>
                <% communities.forEach(function(community) { %>
                    <tr>
                        <td><input type="checkbox" name="commCheck"  id='<%- community.id %>'/></td>
                        <td><%= community.id %></td>
                        <td><%= community.data().name %></td>
                        <td><%= community.data().description %></td>
                        
                    </tr>
                <% }); %>    
            </tbody>
        </table>
    </div>
<!-- Delete Community Warning Modal -->
<div class="modal fade" id="deleteCommunityModal" tabindex="-1" role="dialog" aria-labelledby="deleteCommunityLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <center><h5 class="modal-title" id="deleteCommunityLabel">Are you sure you want to delete the communities?</h5></center>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-footer">
        <button id="modalDeleteBtn" type="button" class="btn btn-primary" onclick="deleteComms()" data-dismiss="modal">Delete</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>
    


</main>

<script src="https://www.gstatic.com/firebasejs/3.7.4/firebase.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js" type="text/javascript"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>


<script>
    function createCommunity(){
    window.location.href = "/create_community";
  }

  function toggle(source) {
        checkboxes = document.getElementsByName('commCheck');
        for(var i=0, n=checkboxes.length;i<n;i++) {
            checkboxes[i].checked = source.checked;
        }
    }

  function confirmMessage(){
    $("#deleteCommunityModal").modal("show");
  }

  function deleteComms()
    {
        
      var commIDs =[];
      var roles;
      checkboxes = document.getElementsByName('commCheck');
      for(var i=0, n=checkboxes.length;i<n;i++) {
        
          if(checkboxes[i].checked){
              commIDs.push(checkboxes[i].id);
          }
      }
      console.log(commIDs)

      $.ajax({
      statusCode: {
            500: function(data) {
              
              alert("ERROR Deleting communities");
              
            }
          },
        url: '/delete_communities',
        type: 'POST',
        contentType: 'application/json',
        processData: false,
        data: JSON.stringify({commIDs: commIDs}),
        success: function(data){
          location.reload();
        }
      });
    }

</script>

</html>